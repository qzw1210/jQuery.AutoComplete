function js_beautify(d,C){var c,F,s,V,o,z,D,w,e,ai;var I,ac,g,q,y,ah;var T,aa,H;var X,am,l;var al="";C=C?C:{};var U;if(C.space_after_anon_function!==undefined&&C.jslint_happy===undefined){C.jslint_happy=C.space_after_anon_function}if(C.braces_on_own_line!==undefined){U=C.braces_on_own_line?"expand":"collapse"}U=C.brace_style?C.brace_style:(U?U:"collapse");var M=C.indent_size?C.indent_size:4;var k=C.indent_char?C.indent_char:" ";var Z=typeof C.preserve_newlines==="undefined"?true:C.preserve_newlines;var A=typeof C.max_preserve_newlines==="undefined"?false:C.max_preserve_newlines;var v=C.jslint_happy==="undefined"?false:C.jslint_happy;var n=typeof C.keep_array_indentation==="undefined"?false:C.keep_array_indentation;var J=typeof C.space_before_conditional==="undefined"?true:C.space_before_conditional;var m=typeof C.indent_case==="undefined"?false:C.indent_case;var ae=typeof C.unescape_strings==="undefined"?false:C.unescape_strings;am=false;var x=d.length;function u(i){i=typeof i==="undefined"?false:i;while(F.length&&(F[F.length-1]===" "||F[F.length-1]===ai||F[F.length-1]===al||(i&&(F[F.length-1]==="\n"||F[F.length-1]==="\r")))){F.pop()}}function a(i){return i.replace(/^\s\s*|\s\s*$/,"")}function ag(t){t=t.replace(/\x0d/g,"");var j=[],i=t.indexOf("\n");while(i!==-1){j.push(t.substring(0,i));t=t.substring(i+1);i=t.indexOf("\n")}if(t.length){j.push(t)}return j}function h(){var i=n;n=false;E();n=i}function E(an,t){w.eat_next_space=false;if(n&&Q(w.mode)){return}an=typeof an==="undefined"?true:an;t=typeof t==="undefined"?true:t;if(t){w.if_line=false;w.chain_extra_indentation=0}u();if(!F.length){return}if(F[F.length-1]!=="\n"||!an){am=true;F.push("\n")}if(al){F.push(al)}for(var j=0;j<w.indentation_level+w.chain_extra_indentation;j+=1){F.push(ai)}if(w.var_line&&w.var_line_reindented){F.push(ai)}if(w.case_body){F.push(ai)}}function B(){if(V==="TK_COMMENT"){return E()}if(w.eat_next_space){w.eat_next_space=false;return}var i=" ";if(F.length){i=F[F.length-1]}if(i!==" "&&i!=="\n"&&i!==ai){F.push(" ")}}function L(){am=false;w.eat_next_space=false;F.push(s)}function r(){w.indentation_level+=1}function S(){if(F.length&&F[F.length-1]===ai){F.pop()}}function p(i){if(w){e.push(w)}w={previous_mode:w?w.mode:"BLOCK",mode:i,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,chain_extra_indentation:0,in_case_statement:false,in_case:false,case_body:false,eat_next_space:false,indentation_baseline:-1,indentation_level:(w?w.indentation_level+(w.case_body?1:0)+((w.var_line&&w.var_line_reindented)?1:0):0),ternary_depth:0}}function Q(i){return i==="[EXPRESSION]"||i==="[INDENTED-EXPRESSION]"}function G(i){return N(i,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function f(){H=w.mode==="DO_BLOCK";if(e.length>0){var i=w.mode;w=e.pop();w.previous_mode=i}}function ak(t,ao){for(var an=0;an<t.length;an++){var j=a(t[an]);if(j.charAt(0)!==ao){return false}}return true}function P(i){return N(i,["case","return","do","if","throw","else"])}function N(an,j){for(var t=0;t<j.length;t+=1){if(j[t]===an){return true}}return false}function W(j){var i=q;var t=c.charAt(i);while(N(t,I)&&t!==j){i++;if(i>=x){return 0}t=c.charAt(i)}return t}function ab(){var at;var ao;l=0;if(q>=x){return["","TK_EOF"]}X=false;var ax=c.charAt(q);q+=1;var az=n&&Q(w.mode);if(az){var aq=0;while(N(ax,I)){if(ax==="\n"){u();F.push("\n");am=true;aq=0}else{if(ax==="\t"){aq+=4}else{if(ax==="\r"){}else{aq+=1}}}if(q>=x){return["","TK_EOF"]}ax=c.charAt(q);q+=1}if(w.indentation_baseline===-1){w.indentation_baseline=aq}if(am){for(at=0;at<w.indentation_level+1;at+=1){F.push(ai)}if(w.indentation_baseline!==-1){for(at=0;at<aq-w.indentation_baseline;at++){F.push(" ")}}}}else{while(N(ax,I)){if(ax==="\n"){l+=((A)?(l<=A)?1:0:1)}if(q>=x){return["","TK_EOF"]}ax=c.charAt(q);q+=1}if(Z){if(l>1){for(at=0;at<l;at+=1){E(at===0);am=true}}}X=l>0}if(N(ax,ac)){if(q<x){while(N(c.charAt(q),ac)){ax+=c.charAt(q);q+=1;if(q===x){break}}}if(q!==x&&ax.match(/^[0-9]+[Ee]$/)&&(c.charAt(q)==="-"||c.charAt(q)==="+")){var ap=c.charAt(q);q+=1;var aA=ab();ax+=ap+aA[0];return[ax,"TK_WORD"]}if(ax==="in"){return[ax,"TK_OPERATOR"]}if(X&&V!=="TK_OPERATOR"&&V!=="TK_EQUALS"&&!w.if_line&&(Z||o!=="var")){E()}return[ax,"TK_WORD"]}if(ax==="("||ax==="["){return[ax,"TK_START_EXPR"]}if(ax===")"||ax==="]"){return[ax,"TK_END_EXPR"]}if(ax==="{"){return[ax,"TK_START_BLOCK"]}if(ax==="}"){return[ax,"TK_END_BLOCK"]}if(ax===";"){return[ax,"TK_SEMICOLON"]}if(ax==="/"){var au="";var ay=true;if(c.charAt(q)==="*"){q+=1;if(q<x){while(q<x&&!(c.charAt(q)==="*"&&c.charAt(q+1)&&c.charAt(q+1)==="/")){ax=c.charAt(q);au+=ax;if(ax==="\n"||ax==="\r"){ay=false}q+=1;if(q>=x){break}}}q+=2;if(ay&&l===0){return["/*"+au+"*/","TK_INLINE_COMMENT"]}else{return["/*"+au+"*/","TK_BLOCK_COMMENT"]}}if(c.charAt(q)==="/"){au=ax;while(c.charAt(q)!=="\r"&&c.charAt(q)!=="\n"){au+=c.charAt(q);q+=1;if(q>=x){break}}if(X){E()}return[au,"TK_COMMENT"]}}if(ax==="'"||ax==='"'||(ax==="/"&&((V==="TK_WORD"&&P(o))||(o===")"&&N(w.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"]))||(V==="TK_COMMA"||V==="TK_COMMENT"||V==="TK_START_EXPR"||V==="TK_START_BLOCK"||V==="TK_END_BLOCK"||V==="TK_OPERATOR"||V==="TK_EQUALS"||V==="TK_EOF"||V==="TK_SEMICOLON")))){var aB=ax;
var aw=false;var an=0;var j=0;ao=ax;if(q<x){if(aB==="/"){var av=false;while(aw||av||c.charAt(q)!==aB){ao+=c.charAt(q);if(!aw){aw=c.charAt(q)==="\\";if(c.charAt(q)==="["){av=true}else{if(c.charAt(q)==="]"){av=false}}}else{aw=false}q+=1;if(q>=x){return[ao,"TK_STRING"]}}}else{while(aw||c.charAt(q)!==aB){ao+=c.charAt(q);if(an&&an>=j){an=parseInt(ao.substr(-j),16);if(an&&an>=32&&an<=126){an=String.fromCharCode(an);ao=ao.substr(0,ao.length-j-2)+(((an===aB)||(an==="\\"))?"\\":"")+an}an=0}if(an){an++}else{if(!aw){aw=c.charAt(q)==="\\"}else{aw=false;if(ae){if(c.charAt(q)==="x"){an++;j=2}else{if(c.charAt(q)==="u"){an++;j=4}}}}}q+=1;if(q>=x){return[ao,"TK_STRING"]}}}}q+=1;ao+=aB;if(aB==="/"){while(q<x&&N(c.charAt(q),ac)){ao+=c.charAt(q);q+=1}}return[ao,"TK_STRING"]}if(ax==="#"){if(F.length===0&&c.charAt(q)==="!"){ao=ax;while(q<x&&ax!=="\n"){ax=c.charAt(q);ao+=ax;q+=1}F.push(a(ao)+"\n");E();return ab()}var ar="#";if(q<x&&N(c.charAt(q),ah)){do{ax=c.charAt(q);ar+=ax;q+=1}while(q<x&&ax!=="#"&&ax!=="=");if(ax==="#"){}else{if(c.charAt(q)==="["&&c.charAt(q+1)==="]"){ar+="[]";q+=2}else{if(c.charAt(q)==="{"&&c.charAt(q+1)==="}"){ar+="{}";q+=2}}}return[ar,"TK_WORD"]}}if(ax==="<"&&c.substring(q-1,q+3)==="<!--"){q+=3;ax="<!--";while(c.charAt(q)!=="\n"&&q<x){ax+=c.charAt(q);q++}w.in_html_comment=true;return[ax,"TK_COMMENT"]}if(ax==="-"&&w.in_html_comment&&c.substring(q-1,q+2)==="-->"){w.in_html_comment=false;q+=2;if(X){E()}return["-->","TK_COMMENT"]}if(ax==="."){return[ax,"TK_DOT"]}if(N(ax,g)){while(q<x&&N(ax+c.charAt(q),g)){ax+=c.charAt(q);q+=1;if(q>=x){break}}if(ax===","){return[ax,"TK_COMMA"]}else{if(ax==="="){return[ax,"TK_EQUALS"]}else{return[ax,"TK_OPERATOR"]}}}return[ax,"TK_UNKNOWN"]}ai="";while(M>0){ai+=k;M-=1}while(d&&(d.charAt(0)===" "||d.charAt(0)==="\t")){al+=d.charAt(0);d=d.substring(1)}c=d;D="";V="TK_START_EXPR";o="";z="";F=[];H=false;I="\n\r\t ".split("");ac="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");ah="0123456789".split("");g="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";g+=" <%= <% %> <?= <? ?>";g=g.split(" ");y="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");e=[];p("BLOCK");q=0;while(true){var Y=ab();s=Y[0];aa=Y[1];if(aa==="TK_EOF"){break}switch(aa){case"TK_START_EXPR":if(s==="["){if(V==="TK_WORD"||o===")"){if(N(o,y)){B()}p("(EXPRESSION)");L();break}if(w.mode==="[EXPRESSION]"||w.mode==="[INDENTED-EXPRESSION]"){if(z==="]"&&o===","){if(w.mode==="[EXPRESSION]"){w.mode="[INDENTED-EXPRESSION]";if(!n){r()}}p("[EXPRESSION]");if(!n){E()}}else{if(o==="["){if(w.mode==="[EXPRESSION]"){w.mode="[INDENTED-EXPRESSION]";if(!n){r()}}p("[EXPRESSION]");if(!n){E()}}else{p("[EXPRESSION]")}}}else{p("[EXPRESSION]")}}else{if(D==="for"){p("(FOR-EXPRESSION)")}else{if(N(D,["if","while"])){p("(COND-EXPRESSION)")}else{p("(EXPRESSION)")}}}if(o===";"||V==="TK_START_BLOCK"){E()}else{if(V==="TK_END_EXPR"||V==="TK_START_EXPR"||V==="TK_END_BLOCK"||o==="."){if(X){E()}}else{if(V!=="TK_WORD"&&V!=="TK_OPERATOR"){B()}else{if(D==="function"||D==="typeof"){if(v){B()}}else{if(N(o,y)||o==="catch"){if(J){B()}}}}}}L();break;case"TK_DOT":if(P(o)){B()}else{if(o===")"){w.chain_extra_indentation=1;E(true,false)}}L();break;case"TK_END_EXPR":if(s==="]"){if(n){if(o==="}"){S();L();f();break}}else{if(w.mode==="[INDENTED-EXPRESSION]"){if(o==="]"){f();E();L();break}}}}f();L();break;case"TK_START_BLOCK":if(D==="do"){p("DO_BLOCK")}else{p("BLOCK")}if(U==="expand"||U==="expand-strict"){var aj=false;if(U==="expand-strict"){aj=(W()==="}");if(!aj){E(true)}}else{if(V!=="TK_OPERATOR"){if(o==="="||(P(o)&&o!=="else")){B()}else{E(true)}}}L();if(!aj){r()}}else{if(V!=="TK_OPERATOR"&&V!=="TK_START_EXPR"){if(V==="TK_START_BLOCK"){E()}else{B()}}else{if(Q(w.previous_mode)&&o===","){if(z==="}"){B()}else{E()}}}r();L()}break;case"TK_END_BLOCK":f();if(U==="expand"||U==="expand-strict"){if(o!=="{"){E()}L()}else{if(V==="TK_START_BLOCK"){if(am){S()}else{u()}}else{if(Q(w.mode)&&n){n=false;E();n=true}else{E()}}L()}break;case"TK_WORD":if(H){B();L();B();H=false;break}T="NONE";if(s==="function"){if(w.var_line&&V!=="TK_EQUALS"){w.var_line_reindented=true}if((am||o===";")&&o!=="{"&&V!=="TK_BLOCK_COMMENT"&&V!=="TK_COMMENT"){l=am?l:0;if(!Z){l=1}for(var af=0;af<2-l;af++){E(false)}}if(V==="TK_WORD"){if(o==="get"||o==="set"||o==="new"||o==="return"){B()}else{E()}}else{if(V==="TK_OPERATOR"||o==="="){B()}else{if(G(w.mode)){}else{E()}}}L();D=s;break}if(s==="case"||(s==="default"&&w.in_case_statement)){if(o===":"||w.case_body){S()}else{if(!m){w.indentation_level--}E();if(!m){w.indentation_level++}}L();w.in_case=true;w.in_case_statement=true;w.case_body=false;break}if(V==="TK_END_BLOCK"){if(!N(s.toLowerCase(),["else","catch","finally"])){T="NEWLINE"}else{if(U==="expand"||U==="end-expand"||U==="expand-strict"){T="NEWLINE"}else{T="SPACE";B()}}}else{if(V==="TK_SEMICOLON"&&(w.mode==="BLOCK"||w.mode==="DO_BLOCK")){T="NEWLINE"}else{if(V==="TK_SEMICOLON"&&G(w.mode)){T="SPACE"
}else{if(V==="TK_STRING"){T="NEWLINE"}else{if(V==="TK_WORD"){if(o==="else"){u(true)}T="SPACE"}else{if(V==="TK_START_BLOCK"){T="NEWLINE"}else{if(V==="TK_END_EXPR"){B();T="NEWLINE"}}}}}}}if(N(s,y)&&o!==")"){if(o==="else"){T="SPACE"}else{T="NEWLINE"}}if(w.if_line&&V==="TK_END_EXPR"){w.if_line=false}if(N(s.toLowerCase(),["else","catch","finally"])){if(V!=="TK_END_BLOCK"||U==="expand"||U==="end-expand"||U==="expand-strict"){E()}else{u(true);B()}}else{if(T==="NEWLINE"){if(P(o)){B()}else{if(V!=="TK_END_EXPR"){if((V!=="TK_START_EXPR"||s!=="var")&&o!==":"){if(s==="if"&&D==="else"&&o!=="{"){B()}else{w.var_line=false;w.var_line_reindented=false;E()}}}else{if(N(s,y)&&o!==")"){w.var_line=false;w.var_line_reindented=false;E()}}}}else{if(Q(w.mode)&&o===","&&z==="}"){E()}else{if(T==="SPACE"){B()}}}}L();D=s;if(s==="var"){w.var_line=true;w.var_line_reindented=false;w.var_line_tainted=false}if(s==="if"){w.if_line=true}if(s==="else"){w.if_line=false}break;case"TK_SEMICOLON":L();w.var_line=false;w.var_line_reindented=false;if(w.mode==="OBJECT"){w.mode="BLOCK"}break;case"TK_STRING":if(V==="TK_END_EXPR"&&N(w.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])){B()}else{if(V==="TK_COMMENT"||V==="TK_STRING"||V==="TK_START_BLOCK"||V==="TK_END_BLOCK"||V==="TK_SEMICOLON"){E()}else{if(V==="TK_WORD"){B()}}}L();break;case"TK_EQUALS":if(w.var_line){w.var_line_tainted=true}B();L();B();break;case"TK_COMMA":if(w.var_line){if(G(w.mode)||V==="TK_END_BLOCK"){w.var_line_tainted=false}if(w.var_line_tainted){L();w.var_line_reindented=true;w.var_line_tainted=false;E();break}else{w.var_line_tainted=false}L();B();break}if(V==="TK_COMMENT"){E()}if(V==="TK_END_BLOCK"&&w.mode!=="(EXPRESSION)"){L();if(w.mode==="OBJECT"&&o==="}"){E()}else{B()}}else{if(w.mode==="OBJECT"){L();E()}else{L();B()}}break;case"TK_OPERATOR":var b=true;var K=true;if(P(o)){B();L();break}if(s==="*"&&V==="TK_DOT"&&!z.match(/^\d+$/)){L();break}if(s===":"&&w.in_case){if(m){w.case_body=true}L();E();w.in_case=false;break}if(s==="::"){L();break}if(N(s,["--","++","!"])||(N(s,["-","+"])&&(N(V,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||N(o,y)))){b=false;K=false;if(o===";"&&G(w.mode)){b=true}if(V==="TK_WORD"&&N(o,y)){b=true}if(w.mode==="BLOCK"&&(o==="{"||o===";")){E()}}else{if(s===":"){if(w.ternary_depth===0){if(w.mode==="BLOCK"){w.mode="OBJECT"}b=false}else{w.ternary_depth-=1}}else{if(s==="?"){w.ternary_depth+=1}}}if(b){B()}L();if(K){B()}break;case"TK_BLOCK_COMMENT":var O=ag(s);var ad;if(ak(O.slice(1),"*")){E();F.push(O[0]);for(ad=1;ad<O.length;ad++){E();F.push(" ");F.push(a(O[ad]))}}else{if(O.length>1){E()}else{if(V==="TK_END_BLOCK"){E()}else{B()}}for(ad=0;ad<O.length;ad++){F.push(O[ad]);F.push("\n")}}if(W("\n")!=="\n"){E()}break;case"TK_INLINE_COMMENT":B();L();if(G(w.mode)){B()}else{h()}break;case"TK_COMMENT":if(o===","&&!X){u(true)}if(V!=="TK_COMMENT"){if(X){E()}else{B()}}L();E();break;case"TK_UNKNOWN":L();break}z=o;V=aa;o=s}var R=al+F.join("").replace(/[\r\n ]+$/,"");return R}if(typeof exports!=="undefined"){exports.js_beautify=js_beautify};